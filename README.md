# Гайд по схлопыванию миграций #    

Если ваша папка миграций начала содержать в себе слишком большое количество версий, что начинает усложнять процесс разработки командой для отслеживания новых измнений, или же вы просто хотите сдать проект в аккуратном виде, можете попробовать следовать данному гайду, т.к. 

## 1. Убедитесь, что везде актуальная версия миграции ##  
Локально, на dev-стенде, в проде, в общем - ВЕЗДЕ. Также необходимо скооперироваться с остальной командой разработчиков, чтобы ваш коллега не держал у себя незапушенный коммит с изменением модели.    

## 2. Запомните версию текущей миграции ##  
Обязательно запишите версию текущей миграции, взяв ее из таблицы alembic_version. Мы будем использовать ее для подмены версии созданной миграции.  

## 3. Убедитесь, что нет никаких изменений в моделях ##  
Вы могли случайно зацепить nullable какого-нибудь поля, переименовать его и т.д. Такого быть не должно.  

## 4. Создайте локально новую базу данных ##  
Она будет играть роль чистовой базы данных, т.е. делать вид, как будто вы разворачиваете проект с чистого листа. И не забудьте подцепить ее в конфиге вашего приложения. Не удаляйте вашу текущую базу данных, которую вы используете для разработки!  

## 5. Удалите папку migrations  ##  

## 6. Заново создайте репозиторий миграции ##  
Для этого выполните команду `flask db init`  

## 7. Создайте начальную миграцию ##  
Выполните это командой `flask db migrate -m "initial migration"`  

## 8. Отредактируйте файл миграции ##  
В созданной файле миграции поменяйте значение Revision ID (находится в комментарии) и значение переменной revision. Подставьте туда значение версии, которого вы записывали из второго пункта. Также стоит изменить название вашего файла, если оно содержит в себе номер версии.  

## 9. Верните локально прошлую базу данных ##  
Подключите в конфиге приложения прошлую базу данных, после чего примените миграцию к вашей базе данных. С вашей базой ничего не должно случиться, потому что никаких изменений не произошло. Отсутствие ошибок при выполнении миграции свидетельствует о том, что все прошло успешно.  

## Готово! Теперь вы снова можете ориентироваться в файлах миграций и сдавать проект заказчику в красивом и чистом виде
